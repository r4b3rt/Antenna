(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c2474cc0"],{4505:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"platform"},[a("div",{staticClass:"div_card"},[a("a-form-model",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol,hideRequiredMark:!0}},[a("div",{staticClass:"title clearfix"},[a("div",{staticClass:"left"},[e._v("平台设置")])]),a("div",{staticClass:"content"},[a("a-form-model-item",{attrs:{label:"平台注册"}},[a("a-select",{staticStyle:{width:"120px"},on:{change:e.handleChange},model:{value:e.form.REGISTER_TYPE,callback:function(t){e.$set(e.form,"REGISTER_TYPE",t)},expression:"form.REGISTER_TYPE"}},[a("a-select-option",{key:1,attrs:{value:0}},[e._v("禁止注册")]),a("a-select-option",{key:2,attrs:{value:1}},[e._v("开放注册")]),a("a-select-option",{key:3,attrs:{value:2}},[e._v("邀请码注册")])],1)],1),a("a-form-model-item",{ref:"PLATFORM_DOMAIN",attrs:{label:"平台域名",prop:"PLATFORM_DOMAIN"}},[a("a-input",{attrs:{"addon-before":"http://",placeholder:"请输入"},model:{value:e.form.PLATFORM_DOMAIN,callback:function(t){e.$set(e.form,"PLATFORM_DOMAIN",t)},expression:"form.PLATFORM_DOMAIN"}})],1),a("a-form-model-item",{ref:"SERVER_IP",attrs:{label:"公网IP",prop:"PLATFORM_DOMAIN"}},[a("a-input",{attrs:{placeholder:"请输入"},model:{value:e.form.SERVER_IP,callback:function(t){e.$set(e.form,"SERVER_IP",t)},expression:"form.SERVER_IP"}})],1),a("a-form-model-item",{attrs:{label:"开启邮件通知"}},[a("a-switch",{on:{click:function(t){return e.openBtn(t,"OPEN_EMAIL")}},model:{value:e.form.OPEN_EMAIL,callback:function(t){e.$set(e.form,"OPEN_EMAIL",t)},expression:"form.OPEN_EMAIL"}})],1),a("a-form-model-item",{attrs:{label:"保留七天消息"}},[a("a-switch",{on:{click:function(t){return e.openBtn(t,"SAVE_MESSAGE_SEVEN_DAYS")}},model:{value:e.form.SAVE_MESSAGE_SEVEN_DAYS,callback:function(t){e.$set(e.form,"SAVE_MESSAGE_SEVEN_DAYS",t)},expression:"form.SAVE_MESSAGE_SEVEN_DAYS"}})],1),a("a-form-model-item",{ref:"EMAIL_HOST",attrs:{label:"SMTP服务器",prop:"EMAIL_HOST"}},[a("a-input",{attrs:{placeholder:"必填,仅支持smtp协议,如：smtp.xxx.com"},on:{blur:function(){e.$refs.EMAIL_HOST.onFieldBlur()}},model:{value:e.form.EMAIL_HOST,callback:function(t){e.$set(e.form,"EMAIL_HOST",t)},expression:"form.EMAIL_HOST"}})],1),a("a-form-model-item",{ref:"EMAIL_PORT",attrs:{label:"端口",prop:"EMAIL_PORT"}},[a("a-input",{attrs:{placeholder:"必填,如：334"},on:{blur:function(){e.$refs.EMAIL_PORT.onFieldBlur()}},model:{value:e.form.EMAIL_PORT,callback:function(t){e.$set(e.form,"EMAIL_PORT",t)},expression:"form.EMAIL_PORT"}})],1),a("a-form-model-item",{ref:"EMAIL_HOST_USER",attrs:{label:"账号",prop:"EMAIL_HOST_USER"}},[a("a-input",{attrs:{placeholder:"必填,如：text@xxx.com"},on:{blur:function(){e.$refs.EMAIL_HOST_USER.onFieldBlur()}},model:{value:e.form.EMAIL_HOST_USER,callback:function(t){e.$set(e.form,"EMAIL_HOST_USER",t)},expression:"form.EMAIL_HOST_USER"}})],1),a("a-form-model-item",{ref:"EMAIL_HOST_PASSWORD",attrs:{label:"密码/授权码",prop:"EMAIL_HOST_PASSWORD","wrapper-col":{span:14}}},[a("a-row",[a("a-col",{attrs:{span:17}},[a("a-input",{attrs:{placeholder:"必填,如：text@xxx.com"},on:{blur:function(){e.$refs.EMAIL_HOST_PASSWORD.onFieldBlur()}},model:{value:e.form.EMAIL_HOST_PASSWORD,callback:function(t){e.$set(e.form,"EMAIL_HOST_PASSWORD",t)},expression:"form.EMAIL_HOST_PASSWORD"}})],1),a("a-col",{staticClass:"wb-m-l-5",attrs:{span:2}},[a("a-tooltip",[a("template",{slot:"title"},[e._v("发送测试邮件")]),a("a-button",{attrs:{loading:e.sendMailLoaging,icon:"mail"},on:{click:e.getSendMail}})],2)],1)],1)],1),a("a-form-model-item",{staticClass:"wb-m-t-20",attrs:{"wrapper-col":{offset:4}}},[a("a-button",{attrs:{type:"primary",loading:e.renewLoading},on:{click:function(t){return e.onSubmit("ruleForm")}}},[e._v("保存")]),a("a-button",{staticClass:"wb-m-l-5",on:{click:function(t){return e.resetForm("ruleForm")}}},[e._v("重置")])],1)],1)])],1),a("div",{staticClass:"div_card"},[a("a-form-model",{ref:"ruleForm1",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol,hideRequiredMark:!0}},[a("div",{staticClass:"title clearfix"},[a("div",{staticClass:"left"},[e._v("协议设置")])]),a("div",{staticClass:"content"},[a("a-table",{key:"id",attrs:{columns:e.columns,"data-source":e.tableData},scopedSlots:e._u([{key:"type",fn:function(t){return a("a",{},[e._v("A")])}},{key:"domain",fn:function(t,r){return a("a",{},[a("a-Input",{attrs:{value:t},on:{change:function(t){return e.inputDomain(t,r)}}})],1)}},{key:"value",fn:function(t,r){return a("a",{},[a("a-select",{attrs:{mode:"tags",value:t},on:{change:function(t){return e.setvalues(t,r)}}})],1)}},{key:"id",fn:function(t,r){return a("a",{},[a("a-button",{staticClass:"mgright5",attrs:{type:"primary"},on:{click:function(t){return e.saveDns(r)}}},[e._v("保存")]),a("a-popconfirm",{attrs:{title:"确认删除本行吗?","ok-text":"是","cancel-text":"否"},on:{confirm:function(a){return e.onDel(t)}}},[a("a-button",{attrs:{type:"danger"}},[e._v("删除")])],1)],1)}}])})],1)])],1)])},s=[],o=a("0995"),i={data(){return{labelCol:{span:4},wrapperCol:{span:10},wrapperCol1:{span:20},form:{OPEN_REGISTER:"",REGISTER_TYPE:0,name:"",INVITE_TO_REGISTER:"",PLATFORM_DOMAIN:"",OPEN_EMAIL:"",EMAIL_HOST:"",EMAIL_HOST_USER:"",EMAIL_PORT:"",EMAIL_HOST_PASSWORD:"",SAVE_MESSAGE_SEVEN_DAYS:!1,DNS_DOMAIN:"",SERVER_IP:"",NS1_DOMAIN:"",NS2_DOMAIN:"8080",JNDI_PORT:""},formSpare:{},rules:{PLATFORM_DOMAIN:[{required:!0,message:"域名必填",trigger:"blur"},{pattern:new RegExp("^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$"),message:"仅支持域名格式",trigger:"blur"}],EMAIL_HOST:[{validator:this.validatePass,trigger:"blur"},{pattern:new RegExp("^[^一-鿿]+$"),message:"不支持中文",trigger:"blur"}],EMAIL_PORT:[{validator:this.validatePass,trigger:"blur"},{pattern:new RegExp("^[0-9]+$"),message:"只支持数字",trigger:"blur"}],EMAIL_HOST_USER:[{validator:this.validatePass,trigger:"blur"}],EMAIL_HOST_PASSWORD:[{validator:this.validatePass,trigger:"blur"}],DNS_DOMAIN:[{required:!0,message:"不可为空",trigger:"blur"}],SERVER_IP:[{required:!0,message:"不可为空",trigger:"blur"}],NS1_DOMAIN:[{required:!0,message:"不可为空",trigger:"blur"}],NS2_DOMAIN:[{required:!0,message:"不可为空",trigger:"blur"}],JNDI_PORT:[{required:!0,message:"不可为空",trigger:"blur"},{pattern:new RegExp("^[0-9]+$"),message:"只支持数字",trigger:"blur"}]},renewLoading:!1,protocalUpdateLoafing:!1,sendMailLoaging:!1,form2:{},num:1,columns:[{dataIndex:"id",key:"id",title:"id"},{dataIndex:"type",key:"type",title:"解析类型",scopedSlots:{customRender:"type"}},{dataIndex:"domain",key:"domain",title:"解析域名(*.test.com)代表所有子域名",scopedSlots:{customRender:"domain"}},{dataIndex:"value",key:"value",title:"解析内容",scopedSlots:{customRender:"value"}},{dataIndex:"id",key:"id",title:"操作",scopedSlots:{customRender:"id"}}],tableData:[]}},created(){this.initData()},mounted(){this.getDnsInfo()},methods:{saveDns(e){o["a"].dns_update({id:e.id,value:e.value,domain:e.domain}).then(e=>{1===e.code&&(this.$message.success("保存成功"),this.getDnsInfo())})},setvalues(e,t){const a=e.filter(e=>this.isIP(e));this.tableData.forEach(e=>{e.id===t.id&&(e.value=a)})},isIP(e){var t=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return t.test(e)},inputDomain(e,t){this.tableData.forEach(a=>{a.id===t.id&&(a.domain=e.target.value)})},onDel(e){const t=this.tableData.length;this.tableData[t-1].id===e?this.$message.warn("不能删除最后一项"):o["a"].dns_delete({id:e}).then(e=>{1===e.code&&(this.$message.success("删除成功"),this.getDnsInfo())})},getDnsInfo(){o["a"].get_dns().then(e=>{const t=e.data.results,a=t.length;a?t.push({id:t[a-1].id+1,domain:"",value:[]}):t.push({id:1,domain:"",value:[]}),this.tableData=t})},initData(){o["a"].getConfigsManage({page_size:20}).then(e=>{1===e.code&&(this.form=e.data,this.formSpare=Object.assign({},e.data))})},onSubmit(e){this.$refs[e].validate(t=>{t&&("ruleForm"===e?(this.renewLoading=!0,o["a"].getConfigsRenew(this.form).then(e=>{this.renewLoading=!1,1===e.code?(this.form=e.data,this.formSpare=Object.assign({},e.data),o["a"].platform_restart(),this.$message.success("操作成功")):this.$message.error(e.message)})):(this.protocalUpdateLoafing=!0,o["a"].getConfigsProtocalUpdate(this.form).then(e=>{this.protocalUpdateLoafing=!1,1===e.code?(this.form=e.data,this.formSpare=Object.assign({},e.data),o["a"].platform_restart(),this.$message.success("操作成功")):this.$message.error(e.message),console.log("更新协议配置的返回",e)})))})},getSendMail(){this.sendMailLoaging=!0;let e={EMAIL_HOST:this.form.EMAIL_HOST,EMAIL_PORT:this.form.EMAIL_PORT,EMAIL_HOST_USER:this.form.EMAIL_HOST_USER,EMAIL_HOST_PASSWORD:this.form.EMAIL_HOST_PASSWORD};o["a"].getSendMail(e).then(e=>{this.sendMailLoaging=!1,1===e.code?this.$message.success("操作成功"):this.$message.error(e.message)},e=>{this.sendMailLoaging=!1})},openBtn(e,t){let a=this,r=e?"是否打开":"是否关闭";this.$confirm({title:"提示",content:r,onOk(){},onCancel(){a.form[t]=!e}})},validatePass(e,t,a){this.form.OPEN_EMAIL&&(t||a("不可为空")),a()},resetForm(e){this.$refs[e].resetFields(),this.form=Object.assign({},this.formSpare)}}},l=i,n=(a("fd4e"),a("2877")),d=Object(n["a"])(l,r,s,!1,null,"d6edc7cc",null);t["default"]=d.exports},b9b7:function(e,t,a){},fd4e:function(e,t,a){"use strict";a("b9b7")}}]);