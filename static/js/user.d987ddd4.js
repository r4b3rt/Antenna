(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user"],{1348:function(e,r,t){"use strict";t.r(r);var o=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",[e._v("注册页面")])},s=[],i={data(){return{}},created(){},mounted(){},methods:{}},a=i,n=t("2877"),l=Object(n["a"])(a,o,s,!1,null,"56b6177c",null);r["default"]=l.exports},"4bc8":function(e,r,t){e.exports=t.p+"img/bgimg.a479e32e.png"},"951d":function(e,r,t){e.exports=t.p+"img/logotitle.c052c603.png"},ac2a:function(e,r,t){"use strict";t.r(r);var o=function(){var e=this,r=e.$createElement,o=e._self._c||r;return o("div",{staticClass:"bigContain"},[o("img",{staticClass:"bgimge",attrs:{src:t("4bc8"),alt:""}}),o("div",{staticClass:"user-layout-login"},[o("img",{staticClass:"logoImg",attrs:{src:t("951d"),alt:""}}),o("div",{staticClass:"topTitle"},[e._v(e._s(1===e.type?"账号登录":2===e.type?"注册账号":"忘记密码"))]),o("div",{directives:[{name:"show",rawName:"v-show",value:1===e.type,expression:"type === 1"}]},[o("a-form-model",{ref:"ruleFormLogin",attrs:{model:e.form,rules:e.rules}},[o("a-form-model-item",{ref:"username",attrs:{prop:"username"}},[o("a-input",{attrs:{placeholder:"电子邮箱",size:"large"},on:{blur:function(){e.$refs.username.onFieldBlur()},change:function(){e.$refs.username.onFieldBlur()}},model:{value:e.form.username,callback:function(r){e.$set(e.form,"username",r)},expression:"form.username"}},[o("a-icon",{attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),o("a-form-model-item",{ref:"password",attrs:{prop:"loginPd"}},[o("a-input-password",{attrs:{placeholder:"密码",size:"large"},on:{pressEnter:function(r){return e.submitLoginForm("ruleFormLogin")}},model:{value:e.form.loginPd,callback:function(r){e.$set(e.form,"loginPd",r)},expression:"form.loginPd"}},[o("a-icon",{attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),o("a-form-model-item",[o("a-button",{staticClass:"login-form-button",attrs:{type:"primary"},on:{click:function(r){return e.submitLoginForm("ruleFormLogin")}}},[e._v(" 登陆 ")]),o("a",{staticClass:"login-form-forgot",attrs:{href:"javascript:void(0)"},on:{click:e.forgetEvent}},[e._v("忘记密码")]),o("a",{staticClass:"login-form-forgot wb-m-r-10",attrs:{href:"javascript:void(0)"},on:{click:e.registerEvent}},[e._v(" 注册账号 ")])],1)],1)],1),o("div",{directives:[{name:"show",rawName:"v-show",value:2===e.type,expression:"type === 2"}]},[o("a-form-model",{ref:"ruleFormRegister",staticClass:"login-form",attrs:{model:e.form,rules:e.rules}},[o("a-form-model-item",{ref:"name",attrs:{prop:"username"}},[o("a-input",{attrs:{placeholder:"电子邮箱",size:"large"},on:{blur:function(){e.$refs.username.onFieldBlur()},change:function(){e.$refs.username.onFieldBlur()}},model:{value:e.form.username,callback:function(r){e.$set(e.form,"username",r)},expression:"form.username"}},[o("a-icon",{attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),o("a-form-model-item",{ref:"VerificationCode",attrs:{prop:"VerificationCode"}},[o("a-row",{attrs:{gutter:8}},[o("a-col",{attrs:{span:14}},[o("a-input",{attrs:{placeholder:"验证码",size:"large"},on:{blur:function(){e.$refs.VerificationCode.onFieldBlur()},change:function(){e.$refs.VerificationCode.onFieldBlur()}},model:{value:e.form.VerificationCode,callback:function(r){e.$set(e.form,"VerificationCode",r)},expression:"form.VerificationCode"}},[o("a-icon",{attrs:{slot:"prefix",type:"safety-certificate"},slot:"prefix"})],1)],1),o("a-col",{attrs:{span:10}},[o("a-button",{attrs:{size:"large",disabled:e.verificationCodeStatus},on:{click:function(r){return e.getVerificationCode("ruleFormRegister")}}},[e._v(" "+e._s(e.verificationCodeStatus?e.count:"")+e._s(e.verificationCodeText)+" ")])],1)],1)],1),o("a-form-model-item",{ref:"password",attrs:{prop:"password"}},[o("a-input-password",{attrs:{placeholder:"设置密码: 8-16字符,字母区分大小写",size:"large"},on:{blur:function(){e.$refs.password.onFieldBlur()},change:e.getPasswordChange},model:{value:e.form.password,callback:function(r){e.$set(e.form,"password",r)},expression:"form.password"}},[o("a-icon",{attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),o("a-form-model-item",{ref:"passwordAgain",attrs:{prop:"passwordAgain"}},[o("a-input-password",{attrs:{placeholder:"确认密码",size:"large"},model:{value:e.form.passwordAgain,callback:function(r){e.$set(e.form,"passwordAgain",r)},expression:"form.passwordAgain"}},[o("a-icon",{attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),1===e.open_invite?o("a-form-model-item",{ref:"InvitationCode",attrs:{prop:1===e.open_invite?"InvitationCode":""}},[o("a-input",{attrs:{placeholder:"邀请码",size:"large"},on:{blur:function(){e.$refs.InvitationCode.onFieldBlur()},change:function(){e.$refs.InvitationCode.onFieldBlur()},pressEnter:e.submitRegisterForm},model:{value:e.form.InvitationCode,callback:function(r){e.$set(e.form,"InvitationCode",r)},expression:"form.InvitationCode"}},[o("a-icon",{attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1):e._e(),o("a-form-model-item",[o("a-button",{staticClass:"login-form-button",attrs:{type:"primary"},on:{click:function(r){return e.submitRegisterForm()}}},[e._v("注册")]),o("a",{staticClass:"login-form-forgot",attrs:{href:"javascript:void(0)"},on:{click:e.loginEvent}},[e._v("使用已有账号登陆")])],1)],1)],1),o("div",{directives:[{name:"show",rawName:"v-show",value:3===e.type,expression:"type === 3"}]},[o("a-form-model",{ref:"ruleFormForget",staticClass:"login-form",attrs:{model:e.form,rules:e.rules}},[o("a-form-model-item",{ref:"username",attrs:{prop:"username"}},[o("a-input",{attrs:{placeholder:"电子邮箱",size:"large"},model:{value:e.form.username,callback:function(r){e.$set(e.form,"username",r)},expression:"form.username"}},[o("a-icon",{attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),o("a-form-model-item",{ref:"VerificationCode",attrs:{prop:"VerificationCode"}},[o("a-row",{attrs:{gutter:8}},[o("a-col",{attrs:{span:14}},[o("a-input",{attrs:{placeholder:"验证码",size:"large"},on:{blur:function(){e.$refs.VerificationCode.onFieldBlur()},change:function(){e.$refs.VerificationCode.onFieldBlur()}},model:{value:e.form.VerificationCode,callback:function(r){e.$set(e.form,"VerificationCode",r)},expression:"form.VerificationCode"}},[o("a-icon",{attrs:{slot:"prefix",type:"safety-certificate"},slot:"prefix"})],1)],1),o("a-col",{attrs:{span:10}},[o("a-button",{attrs:{size:"large",disabled:e.verificationCodeStatus},on:{click:function(r){return e.getVerificationCode("ruleFormForget")}}},[e._v(" "+e._s(e.verificationCodeStatus?e.count:"")+e._s(e.verificationCodeText)+" ")])],1)],1)],1),o("a-form-model-item",{ref:"password",attrs:{prop:"password"}},[o("a-input-password",{attrs:{placeholder:"设置密码: 8-16字符,字母区分大小写",size:"large"},on:{blur:function(){e.$refs.password.onFieldBlur()},change:function(){e.$refs.password.onFieldBlur()}},model:{value:e.form.password,callback:function(r){e.$set(e.form,"password",r)},expression:"form.password"}},[o("a-icon",{attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),o("a-form-model-item",{ref:"passwordAgain",attrs:{prop:"passwordAgain"}},[o("a-input-password",{attrs:{placeholder:"确认密码",size:"large"},on:{blur:function(){e.$refs.passwordAgain.onFieldBlur()},change:function(){e.$refs.passwordAgain.onFieldBlur()}},model:{value:e.form.passwordAgain,callback:function(r){e.$set(e.form,"passwordAgain",r)},expression:"form.passwordAgain"}},[o("a-icon",{attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1),o("a-form-model-item",[o("a-button",{staticClass:"login-form-button",attrs:{type:"primary"},on:{click:function(r){return e.retrieveEvent()}}},[e._v("确认")]),o("a",{staticClass:"login-form-forgot",attrs:{href:"javascript:void(0)"},on:{click:e.loginEvent}},[e._v("使用已有账号登陆")])],1)],1)],1)])])},s=[],i=(t("d9e2"),t("0995")),a={data(){return{labelCol:{span:4},wrapperCol:{span:14},form:{username:"",password:void 0,loginPd:void 0,passwordAgain:"",InvitationCode:void 0,VerificationCode:void 0},rules:{username:[{required:!0,message:"邮箱必填",trigger:"blur"},{pattern:new RegExp("^[a-z0-9A-Z]+[- | a-z0-9A-Z . _]+@([a-z0-9A-Z]+(-[a-z0-9A-Z]+)?\\.)+[a-z]{2,}$"),message:"邮箱格式不正确",trigger:"blur"}],loginPd:[{required:!0,message:"邮箱必填",trigger:"blur"}],password:[{required:!0,message:"密码必填",trigger:"change"},{min:6,message:"密码长度最少6位数",trigger:"blur"},{pattern:new RegExp("^(?=.*([a-zA-Z].*))(?=.*[0-9].*)[a-zA-Z0-9-*/+.~!@#$%^，,&+=_*()]{6,20}$"),message:"密码必须同时包含字母和数字",trigger:"blur"}],passwordAgain:[{required:!0,message:"密码必填",trigger:"change"},{validator:this.validatePass2,trigger:"blur"}],InvitationCode:[{required:!0,message:"必填",trigger:"change"}],VerificationCode:[{required:!0,message:"验证码必填",trigger:"change"}]},type:1,verificationCodeStatus:!1,verificationCodeText:"获取验证码",count:null,open_invite:0}},created(){},mounted(){},methods:{submitLoginForm(e){this.$refs[e].validate(e=>{if(!e)return console.log("error submit!!"),!1;i["a"].getLogin({username:this.form.username,password:this.form.loginPd}).then(e=>{if(1===e.code){const{data:r}=e;this.$message.success("登陆成功"),sessionStorage.setItem("username",r.username),sessionStorage.setItem("token",r.token),sessionStorage.setItem("role",r.is_staff),this.$router.push({name:"dashboard"})}else this.$message.error(e.message)},e=>{})})},submitRegisterForm(){this.$refs.ruleFormRegister.validate(e=>{if(!e)return console.log("error submit!!"),!1;i["a"].getRegister({username:this.form.username,password:this.form.password,verify_code:this.form.VerificationCode,invite_code:this.form.InvitationCode}).then(e=>{console.log("注册 正常的返回",e),1===e.code?(this.$message.success("注册成功"),this.type=1,this.$refs.ruleFormRegister.resetFields()):this.$message.error(e.message)})})},getVerificationCode(e){this.$refs[e].validateField("username",e=>{e||(this.verificationCodeStatus=!0,i["a"].getSendmail({username:this.form.username}).then(e=>{if(1===e.code){this.$message.info("验证码已发送，请邮箱查看"),this.verificationCodeText="s 后重新获取";const e=60;if(!this.timer)return this.count=e,void(this.timer=setInterval(()=>{this.count>1&&this.count<=e?this.count--:(clearInterval(this.timer),this.timer=null,this.verificationCodeStatus=!1,this.verificationCodeText="获取验证码")},1e3))}else this.$message.error(e.message),this.verificationCodeStatus=!1,this.verificationCodeText="获取验证码"},e=>{this.verificationCodeStatus=!1}))})},getPasswordChange(e){this.form.passwordAgain=""},retrieveEvent(){this.$refs.ruleFormForget.validate(e=>{if(!e)return console.log("error submit!!"),!1;i["a"].getForgetPassword({username:this.form.username,password:this.form.password,verify_code:this.form.VerificationCode,password_confirm:this.form.passwordAgain}).then(e=>{console.log("忘记密码的返回 正常",e),1===e.code?(this.$message.success("修改成功"),this.type=1,this.$refs.ruleFormForget.resetFields()):this.$message.error(e.message)})})},registerEvent(){this.type=2,i["a"].getOpenInvite().then(e=>{this.open_invite=e.data.open_invite}),this.$refs.ruleFormRegister.resetFields()},loginEvent(){this.type=1,this.$refs.ruleFormLogin.resetFields()},forgetEvent(){this.type=3,this.$refs.ruleFormForget.resetFields()},changeEvent(){this.$refs.ruleFormRetrieve.validate(e=>{if(!e)return console.log("error submit!!"),!1;alert("submit!")})},emailValidator(e,r,t){r.length<2&&t(new Error("长度必须大于2")),t()},validatePass2(e,r,t){this.$refs.ruleFormRegister.validateField("password",e=>{e||(r!==this.form.password&&t(new Error("两次密码不一致")),t())})}}},n=a,l=(t("c359"),t("2877")),f=Object(l["a"])(n,o,s,!1,null,"6c914f70",null);r["default"]=f.exports},c359:function(e,r,t){"use strict";t("ffd0")},ffd0:function(e,r,t){}}]);