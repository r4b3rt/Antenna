(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2bdabd8c"],{2173:function(t,e,a){},"2d2c":function(t,e,a){"use strict";var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-tooltip",{attrs:{slot:"suffix",title:t.copyTitle},slot:"suffix"},[a("a-icon",{staticClass:"copy",attrs:{type:t.copyIcon},on:{click:function(e){return t.copyEvent(t.text)},mouseleave:t.copyMouseleave}})],1)},i=[],o=a("b893"),l={data(){return{copyIcon:"copy",copyTitle:"复制到剪贴板"}},props:{text:""},methods:{copyEvent(t){let e=this;Object(o["copyText"])(t,(function(){e.copyIcon="check",e.copyTitle="复制成功"}))},copyMouseleave(){"check"===this.copyIcon&&(this.copyIcon="copy")}}},n=l,r=(a("c483"),a("2877")),c=Object(r["a"])(n,s,i,!1,null,"2eccf1f6",null);e["a"]=c.exports},"4af6":function(t,e,a){},"696c":function(t,e,a){"use strict";a("c89e")},"8f98":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"div_card"},[t._m(0),a("div",{staticClass:"content"},[a("a-row",{staticClass:"search-area",attrs:{gutter:2}},[a("a-col",{attrs:{span:19}},[a("a-button",{staticClass:"wb-m-r-5",attrs:{type:"primary",icon:"plus-circle",size:"small"},on:{click:t.addEvent}},[t._v(" 新建 ")]),a("a-button",{staticClass:"wb-m-r-5",attrs:{type:"primary",icon:"check-circle",size:"small"},on:{click:function(e){return t.enableEvent(!0)}}},[t._v(" 启用 ")]),a("a-button",{staticClass:"wb-m-r-5",attrs:{type:"primary",icon:"minus-circle",size:"small"},on:{click:function(e){return t.enableEvent(!1)}}},[t._v(" 禁用 ")]),a("a-button",{attrs:{type:"danger",icon:"delete",size:"small"},on:{click:function(e){return t.deleteEvent()}}},[t._v("删除")])],1),a("a-col",{attrs:{span:5}},[a("a-input-search",{attrs:{placeholder:"输入关键字搜索任务名",allowClear:""},on:{search:t.onSearch},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}})],1)],1),a("a-table",{attrs:{columns:t.columns,"data-source":t.data,rowKey:"id",pagination:t.pagination,loading:t.messageLoading,"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange}},on:{change:t.handleTableChange},scopedSlots:t._u([{key:"name",fn:function(e){return a("a",{on:{click:function(a){return a.stopPropagation(),t.editEvent(e)}}},[a("a-popover",[a("template",{slot:"content"},[t._v("点击查看详情")])],2),a("div",{staticClass:"topTip"},[t._v(t._s(e.name))])],1)}},{key:"message_counts",fn:function(e){return a("a",{on:{click:function(a){return a.stopPropagation(),t.jumpEvent(e)}}},[t._v(" "+t._s(e.message_counts)+" ")])}},{key:"status",fn:function(e){return a("span",{},[a("a-switch",{on:{click:function(a){return t.changeStatus(a,e)}},model:{value:e.status,callback:function(a){t.$set(e,"status",a)},expression:"text.status"}})],1)}},{key:"update_time",fn:function(e){return a("span",{},[t._v(t._s(t._f("wuba_dateformat")(e)))])}},{key:"action",fn:function(e){return a("span",{},[a("a",{staticClass:"wb-m-l-5",attrs:{href:"javascript:;"},on:{click:function(a){return t.deleteEvent(e)}}},[t._v("删除")])])}}])})],1)]),t.visible?a("MydDrawer",{attrs:{visible:t.visible,id:t.editId},on:{editEvent:t.update}}):t._e()],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"title clearfix"},[a("div",{staticClass:"left"},[t._v("最新任务")])])}],o=a("1294"),l=a("0995"),n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-drawer",{attrs:{title:t.title,placement:"right",closable:!!t.id,visible:t.visible,width:"40%",wrapClassName:"wb-drawer-div",destroyOnClose:!0,maskClosable:!!t.id,drawerStyle:t.drawerBodyStyle},on:{"update:visible":function(e){t.visible=e},close:t.onClose}},[a("a-card",{staticClass:"wb-m-b-30 clearfix border-radius-5",attrs:{bordered:!1}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("a-icon",{staticClass:"wb-m-r-5",attrs:{twoToneColor:"#eb0806",type:"crown",theme:"twoTone"}}),t._v(" 任务 "),a("a-tooltip",[a("template",{slot:"title"},[t._v("关于监听的介绍")]),a("a-icon",{attrs:{type:"info-circle"}})],2),t.id?a("a-button",{staticClass:"wb-m-r-5 float-right",attrs:{icon:"to-top",size:"small"},on:{click:t.submitAddName}},[t._v(" 保存 ")]):t._e()],1),a("a-form-model",{ref:"taskNameForm",attrs:{model:t.taskNameForm,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[a("a-form-model-item",{ref:"name",attrs:{prop:"name"}},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("任务名称")]),a("a-input",{model:{value:t.taskNameForm.name,callback:function(e){t.$set(t.taskNameForm,"name",e)},expression:"taskNameForm.name"}})],1),a("a-form-model-item",{ref:"callback_url",attrs:{prop:"callback_url"}},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("首页关注")]),a("a-switch",{model:{value:t.taskNameForm.show_dashboard,callback:function(e){t.$set(t.taskNameForm,"show_dashboard",e)},expression:"taskNameForm.show_dashboard"}}),a("a-button",{staticStyle:{float:"right","font-size":"16px"},attrs:{type:"link"},on:{click:function(){t.downAdUp=!t.downAdUp}}},[t._v(" 高级配置 "),t.downAdUp?a("a-icon",{attrs:{type:"down"}}):a("a-icon",{attrs:{type:"up"}})],1)],1),a("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:!t.downAdUp,expression:"!downAdUp"}],ref:"zzz",attrs:{prop:"zzz"}},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("通知接口")]),a("a-input",{model:{value:t.taskNameForm.callback_url,callback:function(e){t.$set(t.taskNameForm,"callback_url",e)},expression:"taskNameForm.callback_url"}})],1),a("a-form-model-item",{directives:[{name:"show",rawName:"v-show",value:!t.downAdUp,expression:"!downAdUp"}],ref:"xxx",attrs:{prop:"xxx"}},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("接口header")]),a("a-input",{model:{value:t.taskNameForm.callback_url_headers,callback:function(e){t.$set(t.taskNameForm,"callback_url_headers",e)},expression:"taskNameForm.callback_url_headers"}})],1)],1)],1),a("a-card",{staticClass:"wb-m-b-30 border-radius-5",attrs:{bordered:!1}},[a("div",{staticClass:"clearfix",attrs:{slot:"title"},slot:"title"},[a("a-icon",{staticClass:"wb-m-r-5",attrs:{type:"notification",theme:"twoTone"}}),t._v(" 监听组件 "),a("a-tooltip",[a("template",{slot:"title"},[t._v("关于监听的介绍")]),a("a-icon",{attrs:{type:"info-circle"}})],2),a("a-button",{staticClass:"wb-m-r-5 float-right",attrs:{icon:"plus",size:"small"},on:{click:function(e){return t.openAddDomain(null,1)}}},[t._v(" 新建 ")])],1),a("a-form-model",t._b({ref:"dynamicValidateForm",staticClass:"wb-form-drawer",attrs:{model:t.dynamicValidateForm}},"a-form-model",t.formItemLayoutWithOutLabel,!1),t._l(t.dynamicValidateForm.domains,(function(e,s){return a("a-form-model-item",{key:s,ref:"domains."+s+".value",refInFor:!0},[a("a-row",{staticClass:"tipTop",attrs:{gutter:3}},[a("a-col",{attrs:{span:4}},[a("a-button",{attrs:{block:"",type:"primary",ghost:""}},[t._v(t._s(e.template_name))])],1),a("a-col",{attrs:{span:16}},[a("a-input",{attrs:{placeholder:"请输入域名",readOnly:!0},model:{value:e.key,callback:function(a){t.$set(e,"key",a)},expression:"domain.key"}},[a("my-copy",{attrs:{slot:"suffix",text:e.key},slot:"suffix"})],1)],1),a("a-col",{attrs:{span:1}},[a("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"edit"},on:{click:function(a){return t.openAddDomain(e,1)}}})],1),a("a-col",{attrs:{span:1}},[a("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o"},on:{click:function(a){return t.removeDomain(e,1)}}})],1)],1)],1)})),1)],1),a("a-card",{staticClass:"wb-m-b-30 border-radius-5",attrs:{bordered:!1}},[a("div",{staticClass:"clearfix",attrs:{slot:"title"},slot:"title"},[a("a-icon",{staticClass:"wb-m-r-5",attrs:{type:"thunderbolt",theme:"twoTone"}}),t._v(" 利用组件 "),a("a-tooltip",[a("template",{slot:"title"},[t._v("关于监听的介绍")]),a("a-icon",{attrs:{type:"info-circle"}})],2),a("a-button",{staticClass:"wb-m-r-5 float-right",attrs:{icon:"plus",size:"small"},on:{click:function(e){return t.openAddDomain(null,0)}}},[t._v(" 新建 ")])],1),a("a-form-model",t._b({ref:"dynamicValidateForm",staticClass:"wb-form-drawer",attrs:{model:t.dynamicValidateForm}},"a-form-model",t.formItemLayoutWithOutLabel,!1),t._l(t.dynamicValidateForm.utilize,(function(e,s){return a("a-form-model-item",{key:s,ref:"utilize."+s+".value",refInFor:!0},[a("a-row",{attrs:{gutter:3}},[a("a-col",{staticClass:"contain",attrs:{span:22}},[[a("a-tooltip",[a("template",{slot:"title"},[t._v(" "+t._s(e.template_name)+" ")]),a("a-button",{staticClass:"b titileButton",attrs:{block:"",type:"primary",ghost:""}},[a("div",{staticClass:"overflow"},[t._v(t._s(e.template_name))])])],2)],a("a-input",{staticClass:"marginright3",staticStyle:{width:"80%"},attrs:{placeholder:"请输入域名",readOnly:!0},model:{value:e.key,callback:function(a){t.$set(e,"key",a)},expression:"domain.key"}},[a("my-copy",{attrs:{slot:"suffix",text:e.key},slot:"suffix"})],1),a("a-icon",{staticClass:"dynamic-delete-button marginright3",attrs:{type:"edit"},on:{click:function(a){return t.openAddDomain(e,0)}}}),a("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o"},on:{click:function(a){return t.removeDomain(e,2)}}})],2)],1)],1)})),1)],1),a("div",{staticClass:"footBtn"},[t.id?t._e():a("a-button",{staticClass:"wb-m-r-5",on:{click:t.onClose}},[t._v("取消")]),t.id?t._e():a("a-button",{staticClass:"wb-m-r-5",on:{click:t.onSure}},[t._v("确定")])],1)],1),a("a-modal",{attrs:{title:"配置"},on:{ok:t.addConfigureOk,cancel:t.onCloseAddDomain},model:{value:t.addModalVisible,callback:function(e){t.addModalVisible=e},expression:"addModalVisible"}},[a("a-form-model",{ref:"ruleForm",attrs:{model:t.form,rules:t.rules,"label-col":t.labelCol,"wrapper-col":t.wrapperCol}},[a("a-form-model-item",{ref:"template",attrs:{label:"组件",prop:"template"}},[a("a-select",{attrs:{placeholder:"请选择组件"},on:{change:t.selectManage},model:{value:t.form.template,callback:function(e){t.$set(t.form,"template",e)},expression:"form.template"}},t._l(t.manageData,(function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v(" "+t._s(e.lable)+" ")])})),1)],1),t.isSingleConfig?a("div",[a("a-form-model-item",{attrs:{label:"配置",prop:"configs"}},[a("a-select",{attrs:{placeholder:"请选择配置"},on:{change:function(e){return t.selectConfig(e)}},model:{value:t.form.configs,callback:function(e){t.$set(t.form,"configs",e)},expression:"form.configs"}},t._l(t.regionData,(function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v(" "+t._s(e.lable)+" ")])})),1)],1),t.form.singConfigs.length?a("div",t._l(t.form.singConfigs,(function(e,s){return a("a-form-model-item",{key:s,attrs:{label:e.name}},[a("a-input",{model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"it.value"}})],1)})),1):t._e()],1):a("div",t._l(t.form.domains,(function(e,s){return a("div",{key:s},[a("a-form-model-item",{attrs:{label:"配置",rules:t.rules1}},[a("a-row",{attrs:{gutter:3}},[a("a-col",{attrs:{span:20}},[a("a-select",{ref:"domains."+s+".value",refInFor:!0,attrs:{prop:"domains."+s+".value",placeholder:"请选择配置"},on:{change:function(e){return t.selectConfig(e,s)},blur:function(e){return t.upDataValidateField(s)}},model:{value:e.configs,callback:function(a){t.$set(e,"configs",a)},expression:"domain.configs"}},t._l(t.regionData,(function(e){return a("a-select-option",{key:e.value,attrs:{value:e.value}},[t._v(" "+t._s(e.lable)+" ")])})),1)],1),a("a-col",{staticClass:"Textright",attrs:{span:2}},[a("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"plus-circle-o",disabled:1===t.form.domains.length},on:{click:function(a){return t.addDomain(e)}}})],1),a("a-col",{staticClass:"Textright",attrs:{span:2}},[t.form.domains.length>1?a("a-icon",{staticClass:"dynamic-delete-button",attrs:{type:"minus-circle-o",disabled:1===t.form.domains.length},on:{click:function(e){return t.removeConfig(s)}}}):t._e()],1)],1)],1),e.value.length?a("div",t._l(e.value,(function(e,s){return a("a-form-model-item",{key:s,attrs:{label:e.name}},[a("a-input",{model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"it.value"}})],1)})),1):t._e()],1)})),0),a("a-form-model-item",{attrs:{label:"生成链接",prop:"configs"}},[a("a-select",{attrs:{placeholder:"请选择生成链接"},on:{change:t.changeLink},model:{value:t.form.url_template,callback:function(e){t.$set(t.form,"url_template",e)},expression:"form.url_template"}},t._l(t.linkList,(function(e){return a("a-select-option",{key:e.id,attrs:{value:e.id}},[t._v(" "+t._s(e.payload)+" ")])})),1)],1)],1)],1)],1)},r=[],c=a("2d2c"),m=a("c24c"),d=a.n(m),u={props:{visible:!1,id:null},components:{MyCopy:c["a"]},data(){return{title:"新建",downAdUp:!0,addModalVisible:!1,labelCol:{span:5},wrapperCol:{span:18},wrapperCol1:{span:3,offset:21},form:{url_template:void 0,template:void 0,configs:void 0,domains:[{configs:"",value:[]}],singConfigs:[],task_config_id:void 0},rules:{template:[{required:!0,message:"组件必填",trigger:"blur"}],configs:[{required:!0,message:"配置必填",trigger:"change"}],name:[{required:!0,message:"任务名称必填",trigger:"change"}]},rules1:[{required:!0,message:"必填",trigger:"blur"}],visibleDetail:!1,drawerBodyStyle:{background:"#ededed"},formItemLayoutWithOutLabel:{wrapperCol:{xs:{span:24,offset:0},sm:{span:20,offset:2}}},dynamicValidateForm:{domains:[],utilize:[]},taskNameForm:{name:"",callback_url:"",callback_url_headers:"",show_dashboard:!0},manageData:[],manageDataChoice:{},configDataChoice:{},regionData:[],linkList:[],onSubmitLoading:!1,isSingleConfig:!0,task_id:"",modalType:null}},created(){this.initData()},methods:{initData(){this.id?(this.title="编辑",this.task_id=this.id,this.getData(this.id,1)):l["a"].create_tmp_task().then(t=>{1===t.code?(this.task_id=t.data.task_info.task_id,this.taskNameForm.name=t.data.task_info.task_name,this.taskNameForm.callback_url=t.data.task_info.callback_url,this.taskNameForm.callback_url_headers=t.data.task_info.callback_url_headers,this.taskNameForm.show_dashboard=t.data.task_info.show_dashboard,this.dynamicValidateForm.domains=t.listen_template_info,this.dynamicValidateForm.utilize=t.payload_template_info):(this.$message.error(t.message),this.onClose())},t=>{this.onClose()})},getData(t){l["a"].getTasksConfigs({task:t}).then(t=>{if(1===t.code){let{data:{task_info:e,payload_template_info:a,listen_template_info:s}}=t;this.taskNameForm.name=e.task_name,this.taskNameForm.callback_url=e.callback_url,this.taskNameForm.callback_url_headers=e.callback_url_headers,this.taskNameForm.show_dashboard=e.show_dashboard,this.dynamicValidateForm.domains=s,this.dynamicValidateForm.utilize=a}else this.$message.error(t.message),this.onClose();this.initTip()},t=>{this.onClose()})},initTip(){let t=sessionStorage.getItem("firstLogin");if("true"==t){const t=new d.a({animate:!1,allowClose:!1});let e=setTimeout(()=>{let a=!0;t.defineSteps([{element:document.getElementsByClassName("tipTop")[0],popover:{title:"组件链接",description:"新建与编辑组件可获取到可以使用的链接",position:"bottom"},showButtons:!0,doneBtnText:"下一步",closeBtnText:"跳出",onNext:()=>{a=!1,this.$router.push({path:"/components"})},onDeselected:()=>{a&&sessionStorage.setItem("firstLogin","false")}}]),t.start(),clearTimeout(e)},100)}},addConfigureOk(){this.$refs.ruleForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t={task:this.task_id,template:this.form.template,url_template:this.form.url_template,template_config_item_list:[]};if(this.isSingleConfig){if(t.template_config_item_list.push({template_config_item:this.form.configs}),this.form.singConfigs.length){let e=this.form.singConfigs.length,a={};for(let t=0;t<e;t++)a[this.form.singConfigs[t].name]=this.form.singConfigs[t].value;t.template_config_item_list[0].value=a}}else{let a=this.form.domains.length;for(var e=0;e<a;e++){let a={};a.template_config_item=this.form.domains[e].configs,a.value=this.handleData(this.form.domains[e].value),t.template_config_item_list.push(a)}}1===this.modalType?(t.task_config=this.form.task_config_id,this.id?l["a"].getTasksConfigsUpdate(t).then(t=>{if(1===t.code){let{data:{listen_template_info:e,payload_template_info:a}}=t;this.dynamicValidateForm.domains=e,this.dynamicValidateForm.utilize=a,this.$message.success("操作成功"),this.onCloseAddDomain(),this.form.task_config_id=null}else this.$message.error(t.message)}):l["a"].tmp_update_config(t).then(t=>{if(1===t.code){let{data:{listen_template_info:e,payload_template_info:a}}=t;this.dynamicValidateForm.domains=e,this.dynamicValidateForm.utilize=a,this.$message.success("操作成功"),this.onCloseAddDomain(),this.form.task_config_id=null}else this.$message.error(t.message)})):this.id?l["a"].getTasksConfigsAdd(t).then(t=>{if(1===t.code){let{data:{listen_template_info:e,payload_template_info:a}}=t;this.dynamicValidateForm.domains=e,this.dynamicValidateForm.utilize=a,this.$message.success("操作成功"),this.onCloseAddDomain()}else this.$message.error(t.message)}):l["a"].tasks_tmp(t).then(t=>{if(1===t.code){let{data:{listen_template_info:e,payload_template_info:a}}=t;this.dynamicValidateForm.domains=e,this.dynamicValidateForm.utilize=a,this.$message.success("操作成功"),this.onCloseAddDomain()}else this.$message.error(t.message)})}})},onClose(){this.dynamicValidateForm.domains=[],this.dynamicValidateForm.utilize=[],this.$refs.taskNameForm.resetFields(),!this.id&&l["a"].cancel_tmp_task({task_id:this.task_id}),this.task_id=null,this.$emit("editEvent",{event:!1,id:this.id})},onSure(){if(!this.id){if(""==this.taskNameForm.name)return void this.$message.error("任务名称不能为空");l["a"].getCreatTask({task_id:this.task_id,task_name:this.taskNameForm.name,callback_url:this.taskNameForm.callback_url,callback_url_headers:this.taskNameForm.callback_url_headers,show_dashboard:this.taskNameForm.show_dashboard}).then(t=>{1===t.code&&this.$message.success("保存成功")})}this.dynamicValidateForm.domains=[],this.dynamicValidateForm.utilize=[],this.$refs.taskNameForm.resetFields(),this.task_id=null,this.$emit("editEvent",{event:!1,id:this.id})},submitAddName(){this.$refs.taskNameForm.validate(t=>{if(!t)return console.log("error submit!!"),!1;{let t={name:this.taskNameForm.name,callback_url:this.taskNameForm.callback_url,callback_url_headers:this.taskNameForm.callback_url_headers,show_dashboard:this.taskNameForm.show_dashboard};l["a"].getTasksManageEdit(this.task_id,t).then(t=>{1===t.code?this.$message.success("操作成功"):this.$message.error("操作成功")})}})},removeConfig(t){this.form.domains.splice(t,1)},removeDomain(t,e){let a=this;this.$confirm({title:"提示",content:"确认删除",onOk(){a.id?l["a"].getTasksConfigsDel(t.task_config_id).then(s=>{if(1===s.code){a.$message.success("操作成功");let s=1===e?a.dynamicValidateForm.domains.indexOf(t):a.dynamicValidateForm.utilize.indexOf(t);-1!==s&&(1===e?a.dynamicValidateForm.domains.splice(s,1):a.dynamicValidateForm.utilize.splice(s,1))}else a.$message.error(s.massage)}):l["a"].tmp_delete_config(t.task_config_id).then(s=>{if(1===s.code){a.$message.success("操作成功");let s=1===e?a.dynamicValidateForm.domains.indexOf(t):a.dynamicValidateForm.utilize.indexOf(t);-1!==s&&(1===e?a.dynamicValidateForm.domains.splice(s,1):a.dynamicValidateForm.utilize.splice(s,1))}else a.$message.error(s.massage)})},onCancel(){}})},getLinkList(t){l["a"].linkList({template:t}).then(t=>{var e;this.linkList=null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.results})},changeLink(t){this.form.url_template=t},openAddDomain(t,e){null!==t&&void 0!==t&&t.template&&this.getLinkList(t.template),l["a"].getTemplatesManage({type:e}).then(e=>{if(1===e.code){t?(this.modalType=1,this.getConfigSelectData(t.template),this.hanlderEidtData(t)):this.modalType=2,this.addModalVisible=!0,this.manageData=[],this.manageDataChoice={};let{data:{results:a}}=e,s=a.length;for(let t=0;t<s;t++){let e={lable:a[t].name,value:a[t].id};this.manageDataChoice[a[t].id]=a[t].choice_type,this.manageData.push(e)}}else this.$message.error(e.message)})},hanlderEidtData(t){if(this.form.template=t.template,this.form.url_template=t.url_template,this.form.task_config_id=t.task_config_id,1===t.template_choice_type){this.isSingleConfig=!1;let e=t.task_config_item_list,a=e.length;if(a){this.form.domains=[];for(let t=0;t<a;t++){let a={value:[]},{value:s}=e[t];a.configs=e[t].template_config_item,Object.keys(s).forEach((function(t){let e={};e.name=t,e.value=s[t],a.value.push(e)})),this.form.domains.push(a)}}}else{this.isSingleConfig=!0,this.form.configs=t.task_config_item_list[0].template_config_item;let e=t.task_config_item_list[0].value,a=this;"{}"==JSON.stringify(e)?this.form.singConfigs=[]:Object.keys(e).forEach((function(t){let s={};s.name=t,s.value=e[t],a.form.singConfigs.push(s)}))}},selectManage(t){1===this.manageDataChoice[t]?this.isSingleConfig=!1:this.isSingleConfig=!0,this.form.singConfigs=[],this.form.domains=[{configs:"",value:[]}],this.form.configs=this.form.configs?"":this.form.configs,this.getConfigSelectData(this.form.template),this.getLinkList(t),this.form.url_template=void 0},getConfigSelectData(t){l["a"].getTemplatessConfigs({template:t}).then(t=>{if(1===t.code){this.regionData=[],this.configDataChoice={};let{data:{results:e}}=t,a=e.length;for(let t=0;t<a;t++){let a={lable:e[t].name,value:e[t].id};this.configDataChoice[e[t].id]=e[t].config,this.regionData.push(a)}}})},selectConfig(t,e){let a=this.configDataChoice[t].length,s=this.configDataChoice[t];if(this.isSingleConfig){this.form.singConfigs=[];for(let t=0;t<a;t++){let e={name:s[t],value:""};this.form.singConfigs.push(e)}}else if(this.form.domains[e].value=[],a)for(let i=0;i<a;i++){let t={name:s[i],value:""};this.form.domains[e].value.push(t)}},upDataValidateField(t){let e="domains."+t+".value";this.$refs.ruleForm.validateField(e)},onCloseAddDomain(){this.form.singConfigs=[],this.$nextTick(()=>{this.modalType=null,this.form.template=void 0,this.form.configs=void 0,this.form.domains=[{configs:"",value:[]}]}),this.isSingleConfig=!0,this.regionData=[],this.addModalVisible=!1,this.$refs.ruleForm.resetFields()},addDomain(){this.form.domains.push({configs:null,value:[],key:Date.now()})},resetForm(){this.$refs.ruleForm.resetFields()},handleData(t){let e=t.length,a={};if(0===e)return a;for(let s=0;s<e;s++)a[t[s].name]=t[s].value;return a}}},h=u,f=(a("696c"),a("2877")),p=Object(f["a"])(h,n,r,!1,null,null,null),g=p.exports,_={components:{MydDrawer:g},data(){return{testData:o["a"].testData,columns:[{title:"ID",dataIndex:"id",key:"id"},{title:"任务名称",key:"name",scopedSlots:{customRender:"name"}},{title:"消息总数",key:"message_counts",scopedSlots:{customRender:"message_counts"}},{title:"更新时间",dataIndex:"update_time",key:"update_time",scopedSlots:{customRender:"update_time"}},{title:"开启状态",key:"status",scopedSlots:{customRender:"status"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],data:[],pagination:{pageSizeOptions:["10","20","30","40","50"],showSizeChanger:!0,pageSize:10},messageLoading:!1,selectedRowKeys:[],visible:!1,editId:null,dynamicValidateForm:{domains:[]},taskNameForm:{name:"",callback_url:""},configData:[],configDataChoice:{},regionData:[],onSubmitLoading:!1,isMoreConfig:!1,searchValue:""}},created(){this.initData()},mounted(){},methods:{initData(t={}){this.loading=!0;let e={page_size:this.pagination.pageSize,search:this.searchValue,page:1,...t};1===e.page&&(this.pagination.current=1),l["a"].getTasksManage(e).then(t=>{if(1===t.code){let{data:e}=t;const a={...this.pagination};a.total=e.count,this.pagination=a,this.data=e.results,this.initTast(this.data[0])}})},initTast(t){let e=sessionStorage.getItem("firstLogin");if("true"==e){const e=new d.a({allowClose:!1});let a=setTimeout(()=>{let s=!0;e.defineSteps([{element:document.getElementsByClassName("topTip")[0],popover:{title:"任务详情",description:"查看自己任务的详细信息",position:"right"},showButtons:!0,doneBtnText:"下一步",closeBtnText:"跳出",onDeselected:()=>{s&&sessionStorage.setItem("firstLogin","false")},onNext:()=>{s=!1,this.editEvent(t)}}]),e.start(),clearTimeout(a)},10)}},changeStatus(t,e){let a=this;this.$confirm({title:"提示",content:t?"是否开启":"是否关闭",onOk(){let s={id:[],status:t};s.id.push(e.id),a.getChangeStatus(s)},onCancel(){e.status=!t}})},update(t){t.id&&(this.editId=null),this.visible=!1,setTimeout(()=>{this.initData()},500)},changeNum(){this.testData.handleNum(9)},onSearch(){this.initData()},handleTableChange(t){const e={...this.pagination};e.current=t.current,e.pageSize=t.pageSize,this.pagination=e;let a={page_size:t.pageSize,page:t.current};this.initData(a)},addEvent(){this.visible=!0},editEvent(t){this.editId=t.id,this.visible=!0},jumpEvent(t){this.$router.push({name:"message",query:{id:t.id}})},enableEvent(t){if(0===this.selectedRowKeys.length)return this.$message.error("未选择任何数据");let e={id:this.selectedRowKeys,status:t};this.getChangeStatus(e)},getChangeStatus(t){l["a"].getTasksManageStatus(t).then(t=>{1===t.code?(this.$message.success("操作成功"),this.selectedRowKeys=[]):this.$message.error(t.message),this.initData()})},getDeleTask(t){l["a"].getTasksManageDele(t).then(t=>{1===t.code?(this.$message.success("操作成功"),this.selectedRowKeys=[]):this.$message.error(t.message),this.initData()})},deleteEvent(t=""){let e=this;if(t)this.$confirm({title:"提示",content:"确认删除",onOk(){let a={id:t.id};e.getDeleTask(a)},onCancel(){}});else{if(0===this.selectedRowKeys.length)return this.$message.error("未选择任何数据");let t={id:this.selectedRowKeys.join(",")};this.getDeleTask(t)}},onSelectChange(t){this.selectedRowKeys=t}}},k=_,b=(a("b039"),Object(f["a"])(k,s,i,!1,null,"a79d6cfc",null));e["default"]=b.exports},b039:function(t,e,a){"use strict";a("2173")},b893:function(t,e){function a(t){let e={};for(const a in t)e[a]=t[a].join(",");return e}function s(t,e){var a=document.createElement("input");a.setAttribute("id","cp_hgz_input"),a.value=t,document.getElementsByTagName("body")[0].appendChild(a),document.getElementById("cp_hgz_input").select(),document.execCommand("copy"),document.getElementById("cp_hgz_input").remove(),e&&e(t)}t.exports={handleFilters:a,copyText:s}},c483:function(t,e,a){"use strict";a("4af6")},c89e:function(t,e,a){}}]);